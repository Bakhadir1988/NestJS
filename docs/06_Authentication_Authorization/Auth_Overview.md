# Обзор: Аутентификация vs. Авторизация

При построении любого защищенного приложения крайне важно понимать разницу между двумя фундаментальными понятиями: **Аутентификация** и **Авторизация**. Часто их путают, но они отвечают на совершенно разные вопросы.

---

## 1. Аутентификация (Authentication)

-   **Ключевой вопрос:** «Кто ты?»
-   **Цель:** Проверить и подтвердить личность того, кто пытается получить доступ к системе.
-   **Аналогия:** Предъявление паспорта на границе. Система проверяет, что вы — это действительно тот, за кого себя выдаете.

Процесс аутентификации всегда происходит **первым**. Система не может дать права, пока не узнает, *кому* их давать.

**Примеры в жизни:**
-   Ввод логина и пароля на сайте.
-   Сканирование отпечатка пальца на телефоне.
-   Ввод PIN-кода от банковской карты.

**В нашем API:**
-   Когда пользователь отправляет `email` и `password` на эндпоинт `/auth/login`.

---

## 2. Авторизация (Authorization)

-   **Ключевой вопрос:** «Что тебе разрешено делать?»
-   **Цель:** Определить, какими правами и разрешениями обладает уже аутентифицированный пользователь.
-   **Аналогия:** Ваш паспорт позволил вам въехать в страну (аутентификация). Но именно виза в паспорте определяет, есть ли у вас право здесь работать (авторизация).

Процесс авторизации происходит **после** успешной аутентификации.

**Примеры в жизни:**
-   Обычный сотрудник не может получить доступ к финансовым отчетам компании.
-   Читатель в библиотеке может брать книги, но не может их списывать из фонда.

**В нашем API:**
-   Проверка, может ли пользователь `USER_A` редактировать доску, созданную пользователем `USER_B`.
-   Проверка, является ли пользователь "администратором" системы.

---

## 3. Как это реализуется в NestJS

NestJS предоставляет четкие строительные блоки для обоих процессов.

| Концепт | За что отвечает | Где используется в NestJS |
| :--- | :--- | :--- |
| **Аутентификация** | Проверка личности | **Стратегии Passport.js** (например, `JwtStrategy`, `LocalStrategy`). Они инкапсулируют логику проверки (проверить пароль, проверить токен). |
| **Авторизация** | Проверка прав доступа | **Гарды (Guards)**. Они используют результат аутентификации для принятия решения: пускать пользователя дальше или нет. |

### Упрощенный цикл запроса

1.  **Входящий запрос** с токеном в заголовке `Authorization`.
2.  **`JwtAuthGuard`** активируется.
3.  Гард вызывает **`JwtStrategy`** (часть Passport.js).
4.  **`JwtStrategy`** (Аутентификация):
    -   Проверяет, валиден ли JWT.
    -   Если да, извлекает из него `payload` (например, `{ userId: 123 }`).
    -   Возвращает объект `user`, который NestJS помещает в объект `request`.
5.  **`JwtAuthGuard`** (Авторизация):
    -   Получает `user` от стратегии.
    -   Принимает решение. На простейшем уровне: если `user` существует, значит, аутентификация пройдена, возвращаем `true`.
6.  **Контроллер:** Запрос, обогащенный данными о пользователе (`request.user`), доходит до конечного обработчика.

---

## 4. Вывод

-   **Аутентификация** — это вход в систему.
-   **Авторизация** — это проверка прав внутри системы.

Четкое разделение этих двух концепций позволяет строить гибкие и безопасные приложения. NestJS, благодаря своей модульности и интеграции с Passport, делает этот процесс элегантным и управляемым.
