# Шпаргалка: Встроенные HTTP-исключения в NestJS

В NestJS существует стандартный набор встроенных исключений, которые наследуются от базового класса `HttpException`. Использование этих готовых классов — лучшая практика, так как они автоматически генерируют правильные HTTP-ответы с нужными кодами состояния.

Все они импортируются из `@nestjs/common`.

### Как использовать

Исключения "выбрасываются" с помощью ключевого слова `throw`.

```typescript
import { NotFoundException } from '@nestjs/common';

// ...
if (!resource) {
  throw new NotFoundException('Этот ресурс не был найден');
}
```

Конструктор каждого исключения может принимать два аргумента:
1.  `message` (string): Краткое описание ошибки для клиента.
2.  `error` (string, необязательно): Краткое описание самой ошибки (например, 'Not Found').

---

## Основные классы исключений

| Класс исключения             | HTTP Статус        | Когда использовать                                                                                               |
| ---------------------------- | ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| `BadRequestException`        | 400 Bad Request    | Запрос некорректен (например, неверный формат данных). Часто используется `ValidationPipe`.                       |
| `UnauthorizedException`      | 401 Unauthorized   | Пользователь не аутентифицирован (не предоставил токен или токен недействителен). Обычно используется в `Guards`.   |
| `ForbiddenException`         | 403 Forbidden      | Пользователь аутентифицирован, но у него нет прав на выполнение данного действия (например, доступ к чужому ресурсу). |
| `NotFoundException`          | 404 Not Found      | Запрашиваемый ресурс не найден на сервере (например, `GET /users/999`).                                            |
| `ConflictException`          | 409 Conflict       | Запрос конфликтует с текущим состоянием сервера (например, попытка создать пользователя с уже занятым `email`).     |
| `InternalServerErrorException` | 500 Internal Error | Произошла непредвиденная ошибка на сервере. Редко выбрасывается вручную, чаще это результат не пойманной ошибки. |
| `NotAcceptableException`     | 406 Not Acceptable | Сервер не может сгенерировать ответ, который соответствует заголовкам `Accept-*`, присланным клиентом.           |
| `GatewayTimeoutException`    | 504 Gateway Timeout| Сервер, выступая в роли шлюза, не дождался ответа от вышестоящего сервера.                                       |

---

### Кастомизация ответа об ошибке

Вместо простой строки, вы можете передать в конструктор исключения объект, чтобы предоставить клиенту более подробную информацию.

**Пример:**
```typescript
import { ConflictException } from '@nestjs/common';

// ...
if (userExists) {
  throw new ConflictException({
    statusCode: 409,
    message: 'User with this email already exists.',
    field: 'email',
  });
}
```

**Результат в Postman:**
```json
{
    "statusCode": 409,
    "message": "User with this email already exists.",
    "field": "email"
}
```

### Лучшие практики

1.  **Будьте специфичны:** Всегда выбирайте наиболее подходящий класс исключения. Не используйте `BadRequestException` там, где лучше подходит `ForbiddenException`.
2.  **Понятные сообщения:** Пишите сообщения об ошибках, которые будут понятны разработчику фронтенда.
3.  **Не раскрывайте детали:** Никогда не включайте в сообщения об ошибках чувствительную информацию (пути к файлам, стектрейсы, тексты SQL-запросов). NestJS по умолчанию скрывает это в продакшен-режиме.
4.  **Используйте встроенные исключения:** Прежде чем создавать свое собственное исключение, убедитесь, что ни одно из встроенных вам не подходит. В 95% случаев их достаточно.
